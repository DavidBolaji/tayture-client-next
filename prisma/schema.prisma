generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model Account {
  id                Int     @id @default(autoincrement())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Applied {
  id        String   @id @default(uuid())
  userId    String
  schoolId  String
  jobId     String
  qual      String
  exp       String
  cv        String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  rating    Int      @default(0)
  user      User     @relation(fields: [userId], references: [id])
  school    School   @relation(fields: [schoolId], references: [sch_id])
  job       Job      @relation(fields: [jobId], references: [job_id])

  @@index([userId])
  @@index([schoolId])
  @@index([jobId])
}

model Assesement {
  a_id      String   @id @default(uuid())
  a_name    String
  a_email   String
  taken     Int
  path      String
  result    String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Blog {
  id              String     @id @default(uuid())
  banner          String
  title           String     @db.VarChar(300)
  except          String     @db.VarChar(300)
  text            String     @db.LongText
  blogCategoryId  String
  blogUserId      String
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  clicks          Int        @default(0)
  isEditor        Boolean    @default(false)
  updatedIsEditor DateTime
  published       Boolean    @default(false)
  categories      Categories @relation(fields: [blogCategoryId], references: [id])
  likes           Like[]
  user            User       @relation(fields: [blogUserId], references: [id])
  comment         Comment[]

  @@index([blogUserId])
  @@index([blogCategoryId])
}

model Categories {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  blog      Blog[]
}

model Comment {
  id           String        @id @default(uuid())
  comment      String
  active       Boolean       @default(true)
  userId       String
  blogId       String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  parentId     String?
  user         User          @relation(fields: [userId], references: [id])
  blog         Blog          @relation(fields: [blogId], references: [id])
  commentLikes CommentLike[]

  @@index([userId])
  @@index([blogId])
}

model CommentLike {
  id        String  @id @default(uuid())
  userId    String
  commentId String
  user      User    @relation(fields: [userId], references: [id])
  comment   Comment @relation(fields: [commentId], references: [id])

  @@index([userId])
  @@index([commentId])
}

model Coupoun {
  id        String   @id @default(uuid())
  value     String
  amount    Int      @default(0)
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  expires   DateTime
  couponJob Job?

  @@index([value])
}

model CVDownloadProcess {
  id        String   @id @default(uuid())
  userId    String
  started   Boolean  @default(true)
  ended     Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model DvaTransaction {
  id            String   @id @default(cuid())
  reference     String   @unique
  amount        Float
  status        String
  accountNumber String
  metadata      String?  @db.LongText
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([reference])
  @@index([accountNumber])
}

model DvaAccount {
  id            String   @id @default(cuid())
  schoolId      String   @unique
  accountNumber String   @unique
  bankName      String
  bankCode      String
  reference     String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  school        School   @relation(fields: [schoolId], references: [sch_id], onDelete: Cascade)

  @@index([schoolId])
  @@index([accountNumber])
  @@index([reference])
}

model Education {
  id         String   @id @default(uuid())
  degree     String
  startYear  String
  endYear    String
  startMonth String?
  endMonth   String?
  school     String
  field      String?
  userId     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Hired {
  id     String @id @default(uuid())
  jobId  String
  userId String
  job    Job    @relation(fields: [jobId], references: [job_id])
  user   User   @relation(fields: [userId], references: [id])

  @@index([jobId])
  @@index([userId])
}

model Instruction {
  id         String   @id @default(uuid())
  text       String   @db.VarChar(255)
  scheduleId String
  schedule   Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
}

model Job {
  job_id         String     @id @default(uuid())
  job_title      String     @db.VarChar(500)
  job_role       String     @db.VarChar(50)
  job_active     String     @db.VarChar(50)
  job_desc       String?    @db.VarChar(255)
  job_min_sal    String     @db.VarChar(255)
  job_max_sal    String     @db.VarChar(255)
  job_exp        String     @db.VarChar(30)
  job_qual       String     @db.VarChar(30)
  active         Boolean    @default(true)
  job_resumption DateTime
  job_no_hires   String
  noPaid         Int        @default(0)
  noScheduled    Int        @default(0)
  deducted       Boolean?   @default(false)
  status         Boolean    @default(false)
  jobSchoolId    String
  jobUserzId     String
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  coupounId      String?    @unique
  assessmentId   String?
  coupon         Coupoun?   @relation(fields: [coupounId], references: [id])
  school         School     @relation(fields: [jobSchoolId], references: [sch_id])
  user           User       @relation(fields: [jobUserzId], references: [id])
  applied        Applied[]
  matched        Matched[]
  hired          Hired[]
  schedule       Schedule[]

  @@index([jobSchoolId])
  @@index([jobUserzId])
  @@index([coupounId])
}

model Like {
  id     String @id @default(uuid())
  userId String
  blogId String
  user   User   @relation(fields: [userId], references: [id])
  blog   Blog   @relation(fields: [blogId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([blogId])
}

model Matched {
  id        String   @id @default(uuid())
  userId    String
  schoolId  String
  jobId     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  school    School   @relation(fields: [schoolId], references: [sch_id])
  job       Job      @relation(fields: [jobId], references: [job_id])

  @@index([userId])
  @@index([schoolId])
  @@index([jobId])
}

model Notifcation {
  id               String   @id @default(uuid())
  caption          String   @db.VarChar(50)
  msg              String   @db.VarChar(255)
  status           Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  notificationUser String
  user             User     @relation(fields: [notificationUser], references: [id])

  @@index([notificationUser])
}

model Others {
  id     String @id @default(uuid())
  text   String
  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Profile {
  id           String  @id @default(uuid())
  picture      String? @db.VarChar(255)
  cv           String? @db.VarChar(255)
  cover        String? @db.VarChar(255)
  description  String? @db.VarChar(300)
  address      String? @db.VarChar(300)
  lga          String? @db.VarChar(30)
  state        String? @db.VarChar(30)
  city         String? @db.VarChar(30)
  available    Boolean @default(false)
  workplace    String? @db.VarChar(100)
  job_location String?
  userId       String  @unique
  country      String? @db.VarChar(100)
  user         User    @relation(fields: [userId], references: [id])
}

model School {
  sch_id           String        @id @default(uuid())
  sch_logo         String?       @db.VarChar(200)
  sch_name         String        @db.VarChar(50)
  sch_no_emp       String        @db.VarChar(30)
  sch_address      String        @db.VarChar(30)
  sch_url          String        @db.VarChar(100)
  sch_phone        String        @db.VarChar(20)
  sch_verified     Int?          @default(0)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  sch_city         String?       @db.VarChar(100)
  sch_state        String        @db.VarChar(80)
  sch_lga          String?       @db.VarChar(100)
  pending_job_post Int           @default(0)
  schUserId        String
  landmark         String?
  country          String?       @default("Nigeria") @db.VarChar(100)
  sch_admin        SchoolAdmin[]
  user             User          @relation(fields: [schUserId], references: [id])
  wallet           Wallet?
  job              Job[]
  applied          Applied[]
  matched          Matched[]
  transaction      Transaction[]
  schedule         Schedule[]
  account          DvaAccount[]

  @@index([schUserId])
}

model SchoolAdmin {
  sch_admin_id     String  @id @default(uuid())
  sch_admin_name   String  @db.VarChar(30)
  sch_admin_email  String  @db.VarChar(30)
  sch_admin_phone  String  @db.VarChar(20)
  schoolId         String
  sch_admin_active Boolean @default(false)
  school           School  @relation(fields: [schoolId], references: [sch_id], onDelete: Cascade)

  @@index([schoolId])
}

model Schedule {
  id          String        @id @default(uuid())
  date        DateTime
  mode        String
  time        DateTime
  status      Status        @default(PENDING)
  city        String?
  lga         String?
  state       String?
  address     String?
  link        String?
  userId      String
  hiredAdmin  Boolean       @default(true)
  hiredUser   Boolean       @default(true)
  reminder    Boolean       @default(false)
  feedback    String?       @db.VarChar(200)
  reason      String?       @db.VarChar(200)
  schoolId    String
  jobId       String
  country     String?
  instruction Instruction[]
  test        Test[]
  user        User          @relation(fields: [userId], references: [id])
  school      School        @relation(fields: [schoolId], references: [sch_id])
  job         Job           @relation(fields: [jobId], references: [job_id])

  @@index([userId])
  @@index([schoolId])
  @@index([jobId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @db.VarChar(300)
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Skills {
  id        String   @id @default(uuid())
  skill     String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Summary {
  id        String   @id @default(uuid())
  text      String   @db.VarChar(500)
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model Test {
  id         String   @id @default(uuid())
  text       String   @db.VarChar(50)
  scheduleId String
  schedule   Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
}

model Transaction {
  id        String      @id @default(uuid())
  amount    Int
  type      WalletState
  message   String
  userId    String
  schoolId  String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id])
  school    School      @relation(fields: [schoolId], references: [sch_id])

  @@index([userId])
  @@index([schoolId])
}

model User {
  id                     String              @id @default(uuid())
  role                   Role                @default(USER)
  path                   String?
  othersText             String?
  fname                  String              @db.VarChar(30)
  lname                  String              @db.VarChar(30)
  email                  String              @unique @db.VarChar(255)
  password               String              @db.VarChar(255)
  phone                  String              @db.VarChar(16)
  validated              Int?                @default(0)
  first_time             Int?                @default(1)
  password_reset_token   String?
  password_reset_expires Int?                @default(0)
  validation_token       String?
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  pinId                  String?
  others                 Others[]
  profile                Profile?
  school                 School[]
  blogs                  Blog[]
  blogLikes              Like[]
  comment                Comment[]
  commentLike            CommentLike[]
  summary                Summary?
  work                   WorkHistory[]
  education              Education[]
  skills                 Skills[]
  wallet                 Wallet[]
  accounts               Account[]
  job                    Job[]
  notification           Notifcation[]
  sessions               Session[]
  applied                Applied[]
  matched                Matched[]
  hired                  Hired[]
  transaction            Transaction[]
  schedule               Schedule[]
  cvDownloadProcesses    CVDownloadProcess[]

  @@index([phone])
}

model Wallet {
  wallet_id             String @id @default(uuid())
  walletSchId           String @unique
  walletUserId          String
  wallet_balance        Int    @default(0)
  wallet_locked_balance Int    @default(0)
  school                School @relation(fields: [walletSchId], references: [sch_id], onDelete: Cascade)
  user                  User   @relation(fields: [walletUserId], references: [id])

  @@index([walletUserId])
  @@index([walletSchId])
}

model WebhookEvent {
  id             String    @id @default(cuid())
  eventType      String
  payload        String    @db.LongText
  processedAt    DateTime?
  status         String    @default("pending")
  retryCount     Int       @default(0)
  idempotencyKey String    @unique
  error          String?   @db.LongText
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([status])
  @@index([idempotencyKey])
}

model WorkHistory {
  id         String     @id @default(uuid())
  title      String     @db.VarChar(300)
  location   String     @db.VarChar(300)
  startYear  String
  endYear    String
  startMonth String
  endMonth   String
  endDate    String?
  city       String?
  state      String?
  lga        String?
  address    String?
  userId     String
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  country    String?
  roles      WorkRole[]
  user       User       @relation(fields: [userId], references: [id])

  @@index([userId])
}

model WorkRole {
  id        String      @id @default(uuid())
  workId    String
  role      String      @db.LongText
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  work      WorkHistory @relation(fields: [workId], references: [id])

  @@index([workId])
}

enum Role {
  ADMIN
  SUPER_ADMIN
  USER
}

enum Status {
  PENDING
  ACCEPTED
  DECLINED
}

enum WalletState {
  CREDIT
  DEBIT
  LOCKED
  UNLOCKED
  BONUS
}
